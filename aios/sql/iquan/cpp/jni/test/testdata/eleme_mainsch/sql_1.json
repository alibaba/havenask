{
    "querys": [
        {
            "sql_params": {
                "iquan.plan.prepare.level": "rel.post.optimize",
                "iquan.plan.cache.enable": "true"
            },
            "dynamic_params": [
                [
                    "\u6cb9\u70b8",
                    120.926362,
                    31.932531,
                    39,
                    120.926362,
                    31.932531,
                    "point(120.926362 31.932531)",
                    120.926362,
                    31.932531,
                    "314",
                    0,
                    10000,
                    "\u6cb9\u70b8 OR \u70b8",
                    "\u6cb9\u70b8",
                    120.926362,
                    31.932531,
                    39,
                    120.926362,
                    31.932531,
                    "point(120.926362 31.932531)",
                    120.926362,
                    31.932531,
                    "314",
                    0,
                    10000,
                    "\u6cb9\u70b8 OR \u70b8",
                    "\u6cb9\u70b8",
                    120.926362,
                    31.932531,
                    120.926362,
                    31.932531,
                    39,
                    "point(120.926362 31.932531)",
                    120.926362,
                    31.932531,
                    "314",
                    0,
                    10000,
                    "\u6cb9\u70b8 OR \u70b8"
                ]
            ],
            "sql": "SELECT store_id AS storeId,hit_type AS httphitType,dist_brand_info AS deliveryMode,logo AS isLogo,effective_supply_value AS isMenu,store_favorable_rate AS likeRateScore,ele_shop_id AS eleShopId,main_category_id AS mainCategoryId,recent_order_num AS recentOrderNum,avg_cost AS unitPrice,is_premium,whole_city_brand_info AS isWholeCity,is_new_retail AS isNewRetail,flavor_ids AS flavorIds,store_score AS baseScore,store_status AS openStatus,real_price ,distance AS distance,item_id AS itemId,eleme_item_id AS eleItemIds,min_sku_id ,min_eleme_food_id AS foodids,reserve_status AS canReserve,reserve_days AS crossDayReserve,store_promotions AS storePromotions,ele_huichang AS elemeHuichang,store_attributes AS storeAttributes,brand_id AS brandId,food_name AS foodnames,monthly_sales_volume AS foodSaleCount,delivery_product_id as productId,d_time as deliveryTime,is_starbucks_agent_shop as isStarbucksAgentShop,delivery_bit AS deliveryBit,store_name AS storeName FROM ( ( select CAST(2 as BIGINT)  as hit_type,store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,store_favorable_rate,recent_order_num,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,is_new_retail,flavor_ids,store_score,store_status,delivery_bit,real_price,distance,item_id,min_sku_id,eleme_item_id,min_eleme_food_id,eleme_vfood_id,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,DUP_tag_names,category_info,food_name,store_name,monthly_sales_volume,d_time from table(rankTvf('', '-store_score','180',(select *,bit_value(delivery_bit , 0 , 20) as area_agent_fee,bit_value(delivery_bit , 40 , 20) as delivery_price from table(rankTvf('store_id', '-monthly_sales_volume','6',(SELECT Store.store_id,Store.ele_shop_id,Store.dist_brand_info,Store.logo,Store.effective_supply_value,Store.is_starbucks_agent_shop,Store.recent_order_num,Store.delivery_product_id,Store.main_category_id,Store.avg_cost,Store.is_premium,Store.whole_city_brand_info,Store.is_new_retail,Store.flavor_ids,store_status,eleme_shop_score(store_status ,distance ,Store.store_name1 ,Store.favorable_rate ,recent_order_num ,?) AS store_score,delivery_fee_compute(poly ,distance ,delivery_price ,delivery_area_agent_fee ,delivery_fee_calculate_template ,delivery_promotion) AS delivery_bit,distance,item_id,min_sku_id,eleme_item_id,min_eleme_food_id,eleme_vfood_id,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,DUP_tag_names,category_info,DUP_name as food_name,store_name,store_name1,monthly_sales_volume,0 AS real_price,Store.favorable_rate AS store_favorable_rate,eleme_tmodel(distance ,delivery_a_tmodel ,avg_delivery_time,delivery_product_id) AS d_time FROM  commodity INNER JOIN  (SELECT store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,eleme_check_reserve(can_reserve, open_time, reserve_days) as reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,is_new_retail,flavor_ids,DUP_full_name as store_name,DUP_name as store_name1,eleme_check_shop_status(can_reserve, busy_level, open_time, will_close_at,reserve_days) AS store_status,favorable_rate,recent_order_num,eleme_distance_compute(longitude ,latitude ,CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,CAST(? AS BIGINT)) AS distance,delivery_price,delivery_area_agent_fee,delivery_fee_calculate_template,delivery_promotion,eleme_delivery_function(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) AS poly,delivery_tmodel,delivery_a_tmodel,avg_delivery_time FROM  store,unnest(store.sub_delivery_table) WHERE  MATCHINDEX('delivery_polygon' , ? ) AND eleme_delivery_filter(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) >= 0 AND notcontain(flavor_ids, ?) AND avg_cost>=? AND avg_cost<=? AND is_new_retail=0)  AS Store ON Store.store_id=commodity.store_id WHERE  QUERY(name,?))))))) )  UNION ALL  ( select CAST(2 as BIGINT)  as hit_type,store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,store_favorable_rate,recent_order_num,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,is_new_retail,flavor_ids,store_score,store_status,delivery_bit,real_price,distance,item_id,min_sku_id,eleme_item_id,min_eleme_food_id,eleme_vfood_id,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,DUP_tag_names,category_info,food_name,store_name,monthly_sales_volume,d_time from table(rankTvf('', '-store_score','180',(select *,bit_value(delivery_bit , 0 , 20) as area_agent_fee,bit_value(delivery_bit , 40 , 20) as delivery_price from table(rankTvf('store_id', '-monthly_sales_volume','6',(SELECT Store.store_id,Store.ele_shop_id,Store.dist_brand_info,Store.logo,Store.effective_supply_value,Store.is_starbucks_agent_shop,Store.recent_order_num,Store.delivery_product_id,Store.main_category_id,Store.avg_cost,Store.is_premium,Store.whole_city_brand_info,Store.is_new_retail,Store.flavor_ids,store_status,eleme_shop_score(store_status ,distance ,Store.store_name1 ,Store.favorable_rate ,recent_order_num ,? ) AS store_score,delivery_fee_compute(poly ,distance ,delivery_price ,delivery_area_agent_fee ,delivery_fee_calculate_template ,delivery_promotion) AS delivery_bit,distance,item_id as item_id,eleme_item_id as min_sku_id,eleme_item_id,eleme_item_id as min_eleme_food_id,eleme_item_id as eleme_vfood_id,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,DUP_tag_names,category_info,DUP_name as food_name,store_name,store_name1,monthly_sales_volume,0 AS real_price,Store.favorable_rate as store_favorable_rate,eleme_tmodel(distance ,delivery_a_tmodel ,avg_delivery_time,delivery_product_id) AS d_time FROM  goods INNER JOIN  (SELECT store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,is_new_retail,flavor_ids,eleme_check_reserve(can_reserve, open_time, reserve_days) as reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,DUP_full_name as store_name,DUP_name as store_name1,eleme_check_shop_status(can_reserve, busy_level, open_time, will_close_at,reserve_days) AS store_status,favorable_rate,recent_order_num,eleme_distance_compute(longitude ,latitude ,CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,CAST(? AS BIGINT)) AS distance,delivery_price,delivery_area_agent_fee,delivery_fee_calculate_template,delivery_promotion,eleme_delivery_function(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) AS poly,delivery_tmodel,delivery_a_tmodel,avg_delivery_time FROM  store,unnest(store.sub_delivery_table) WHERE  MATCHINDEX('delivery_polygon' , ? ) AND eleme_delivery_filter(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) >= 0 AND notcontain(flavor_ids, ?) AND avg_cost>=? AND avg_cost<=? AND is_new_retail=1)  AS Store ON Store.store_id=goods.store_id WHERE  QUERY(name,?))))))) )  UNION ALL  ( SELECT CAST(1 as BIGINT) as hit_type,store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,favorable_rate as store_favorable_rate,recent_order_num,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,is_new_retail,flavor_ids,store_score,store_status,delivery_bit,CAST(0 AS INT) AS real_price,distance,CAST(0 AS BIGINT) AS item_id,CAST(0 AS BIGINT) AS min_sku_id,CAST(0 AS BIGINT) AS eleme_item_id,CAST(0 AS BIGINT) AS min_eleme_food_id,CAST(0 AS BIGINT) AS eleme_vfood_id,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,'' AS DUP_tag_names,'' AS category_info,'' AS food_name,DUP_full_name AS store_name,CAST(0 AS BIGINT) AS monthly_sales_volume,d_time FROM   (SELECT store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,delivery_product_id,recent_order_num,main_category_id,avg_cost,is_new_retail,is_premium,whole_city_brand_info,reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,flavor_ids,DUP_name,DUP_full_name,eleme_shop_score(store_status ,distance ,DUP_name ,favorable_rate ,recent_order_num ,?) AS store_score,store_status,delivery_fee_compute(poly ,distance ,delivery_price ,delivery_area_agent_fee ,delivery_fee_calculate_template ,delivery_promotion) AS delivery_bit,distance,favorable_rate,eleme_tmodel(distance ,delivery_a_tmodel ,avg_delivery_time,delivery_product_id) AS d_time FROM   (SELECT store_id,ele_shop_id,dist_brand_info,logo,effective_supply_value,is_starbucks_agent_shop,delivery_product_id,main_category_id,avg_cost,is_premium,whole_city_brand_info,eleme_check_reserve(can_reserve, open_time, reserve_days) as reserve_status,reserve_days,store_promotions,ele_huichang,store_attributes,brand_id,is_new_retail,flavor_ids,avg_delivery_time,delivery_tmodel,delivery_a_tmodel,DUP_full_name,DUP_name,favorable_rate,recent_order_num,eleme_check_shop_status(can_reserve, busy_level, open_time, will_close_at,reserve_days) AS store_status,delivery_price,delivery_area_agent_fee,delivery_fee_calculate_template,delivery_promotion,eleme_delivery_function(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) AS poly,eleme_distance_compute(longitude ,latitude ,CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,CAST(? AS BIGINT)) AS distance FROM  store,unnest(store.sub_delivery_table) WHERE  MATCHINDEX('delivery_polygon' , ? ) AND eleme_delivery_filter(CAST(? AS DOUBLE) ,CAST(? AS DOUBLE) ,delivery_multi_period ,delivery_polygon) >= 0 AND notcontain(flavor_ids, ?) AND avg_cost>=? AND avg_cost<=? AND  QUERY(name,?)) ORDER BY store_score DESC limit 180) )  )  limit 1080 "
        }
    ]
}
